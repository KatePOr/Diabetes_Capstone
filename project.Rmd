---
title: "Project"
author: "Kate O'Rourke"
date: "2024-10-29"
output: pdf_document
---

```{r}
library(tidyverse)
library(haven)
```

```{r}
CDC_2023 <- read_xpt('LLCP2023.XPT')
```

#### Remove unused columns
```{r}
CDC_2023_subset = subset(CDC_2023, 
                         select = c(EDUCA, EMPLOY1, INCOME3, WEIGHT2, HEIGHT3, SEXVAR, PHYSHLTH, MENTHLTH, PERSDOC3,
                                               MEDCOST1, SMOKE100, DRNK3GE5, EXERANY2, BPHIGH6, TOLDHI3, CVDINFR4,
                                               CVDCRHD4, CVDSTRK3, CHCKDNY2, DIABETE4, DIABTYPE)
                         )
```

```{r}
colSums(is.na(CDC_2023_subset))
```

### Convert columns (except for WEIGHT2 and HEIGHT3) to factors
```{r}
col_names <- colnames(CDC_2023_subset)
col_names <- col_names[-c(4,5, 12, 13)]
CDC_2023_subset[,col_names] <- lapply(CDC_2023_subset[,col_names] , factor)
```

### Get columns summaries for factor data
```{r}
table(CDC_2023_subset$EDUCA, useNA = "ifany")
```
```{r}
table(CDC_2023_subset$EMPLOY1, useNA = "ifany")
```

```{r}
table(CDC_2023_subset$INCOME3, useNA = "ifany")
```

```{r}
table(CDC_2023_subset$SEXVAR, useNA = "ifany")
```

```{r}
table(CDC_2023_subset$PHYSHLTH, useNA = "ifany")
```

```{r}
table(CDC_2023_subset$MENTHLTH, useNA = "ifany")
```

```{r}
table(CDC_2023_subset$PERSDOC3, useNA = "ifany")
```

```{r}
table(CDC_2023_subset$MEDCOST1, useNA = "ifany")
```

```{r}
table(CDC_2023_subset$SMOKE100, useNA = "ifany")
```

```{r}
table(CDC_2023_subset$AVEDRNK3, useNA = "ifany")
```

```{r}
table(CDC_2023_subset$DRNK3GE5, useNA = "ifany")
```

```{r}
table(CDC_2023_subset$EXERANY2, useNA = "ifany")
```

```{r}
table(CDC_2023_subset$BPHIGH6, useNA = "ifany")
```

```{r}
table(CDC_2023_subset$TOLDHI3, useNA = "ifany")
```

```{r}
table(CDC_2023_subset$CVDINFR4, useNA = "ifany")
```

```{r}
table(CDC_2023_subset$CVDCRHD4, useNA = "ifany")
```

```{r}
table(CDC_2023_subset$CVDSTRK3, useNA = "ifany")
```

```{r}
table(CDC_2023_subset$CHCKDNY2, useNA = "ifany")
```

```{r}
table(CDC_2023_subset$DIABETE4, useNA = "ifany")
```

```{r}
table(CDC_2023_subset$DIABTYPE, useNA = "ifany")
```


#### Deal with height in feet and inches and height in metric
```{r}
df <- data.frame(ID = c(501901, 501902))

splitted <- t(sapply(df$ID, function(x) substring(x, first=c(1,2,4), last=c(1,3,6))))
cbind(df, splitted)
#      ID 1  2   3
#1 501901 5 01 901
#2 501902 5 01 902
```


# Filter out rows with metric measurements (e.g., codes like 9061-9998 for metric values)
```{r}

CDC_2023_subset <- CDC_2023_subset %>%
  filter(!(HEIGHT3 >= 9061 & HEIGHT3 <= 9998))

# Extract feet and inches assuming HEIGHT3 values are in a format like '511' (5 feet, 11 inches)
CDC_2023_subset <- CDC_2023_subset %>%
  mutate(
    feet = as.numeric(substr(HEIGHT3, 1, 1)),  # Extract first digit as feet
    inches = as.numeric(substr(HEIGHT3, 2, 3)),  # Extract next two as inches
    height_inches = feet * 12 + inches  # Convert total height to inches
  ) %>%
  select(-feet, -inches) 
```

# Calculate BMI and add it as a new column
```{r}
CDC_2023_subset <- CDC_2023_subset %>%
  mutate(BMI = (WEIGHT2 * 703) / (height_inches^2))
```

# Filter to include individuals with type 2 diabetes, prediabetes, or no diabetes
```{r}
CDC_2023_subset <- CDC_2023_subset %>%
  filter(
    (DIABETE4 == 1 & DIABTYPE == 2) |  # Keep those with type 2 diabetes
    (DIABETE4 == 4) |                  # Keep those with prediabetes
    (DIABETE4 == 3)                    # Keep those with no diabetes
  )
```

# Remove rows with missing or refused data codes
```{r}
CDC_2023_subset <- CDC_2023_subset %>%
  filter(
    EDUCA != 9,             # Refused education level
    EMPLOY1 != 9,           # Refused employment status
    INCOME3 != 99,          # Refused income level
    PHYSHLTH != 77 & PHYSHLTH != 99,  # Don't know or refused physical health
    MENTHLTH != 77 & MENTHLTH != 99,  # Don't know or refused mental health
    PERSDOC3 != 7 & PERSDOC3 != 9,    # Don't know or refused personal doctor info
    MEDCOST1 != 7 & MEDCOST1 != 9,    # Don't know or refused medical cost
    SMOKE100 != 7 & SMOKE100 != 9,    # Don't know or refused smoking info
    DRNK3GE5 != 77 & DRNK3GE5 != 99,  # Don't know or refused binge drinking info
    EXERANY2 != 7 & EXERANY2 != 9,    # Don't know or refused exercise info
    BPHIGH6 != 7 & BPHIGH6 != 9,      # Don't know or refused high blood pressure
    TOLDHI3 != 7 & TOLDHI3 != 9,      # Don't know or refused high cholesterol
    CVDINFR4 != 7 & CVDINFR4 != 9,    # Don't know or refused heart attack history
    CVDCRHD4 != 7 & CVDCRHD4 != 9,    # Don't know or refused coronary heart disease
    CVDSTRK3 != 7 & CVDSTRK3 != 9,    # Don't know or refused stroke history
    CHCKDNY2 != 7 & CHCKDNY2 != 9,    # Don't know or refused kidney disease
    DIABETE4 != 7 & DIABETE4 != 9,    # Don't know or refused diabetes status
    DIABTYPE != 7 & DIABTYPE != 9     # Don't know or refused diabetes type
  )

```

